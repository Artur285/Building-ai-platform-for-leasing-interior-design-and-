<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AI-powered platform for leasing building materials with intelligent recommendations and optimized pricing">
    <meta name="theme-color" content="#667eea">
    <title>AI Building Materials Leasing Platform</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="/static/icons/icon-152x152.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Materials Lease">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        nav {
            background: #34495e;
            padding: 15px 30px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        nav button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s;
        }
        
        nav button:hover {
            background: #2980b9;
        }
        
        nav button.active {
            background: #e74c3c;
        }
        
        .content {
            padding: 30px;
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
        
        .card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #3498db;
        }
        
        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .material-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .material-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .material-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            border-color: #3498db;
        }
        
        .material-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .material-card .category {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 3px 10px;
            border-radius: 3px;
            font-size: 0.85em;
            margin-bottom: 10px;
        }
        
        .material-card .price {
            font-size: 1.5em;
            color: #e74c3c;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .material-card .available {
            color: #27ae60;
            font-weight: bold;
        }
        
        form {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        button[type="submit"] {
            background: #27ae60;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background 0.3s;
        }
        
        button[type="submit"]:hover {
            background: #229954;
        }
        
        .recommendation {
            background: white;
            border: 2px solid #27ae60;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .recommendation .score {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .error {
            background: #fee;
            border: 1px solid #fcc;
            color: #c00;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .success {
            background: #efe;
            border: 1px solid #cfc;
            color: #060;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        
        .pricing-result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .pricing-result h3 {
            margin-bottom: 15px;
        }
        
        .pricing-detail {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }
        
        .pricing-detail:last-child {
            border-bottom: none;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 10px;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèóÔ∏è AI Building Materials Leasing Platform</h1>
            <p>Intelligent Material Recommendations & Optimized Pricing</p>
        </header>
        
        <nav>
            <button onclick="showSection('home')" class="active">Home</button>
            <button onclick="showSection('materials')">Browse Materials</button>
            <button onclick="showSection('recommendations')">AI Recommendations</button>
            <button onclick="showSection('pricing')">Pricing Calculator</button>
            <button onclick="showSection('about')">About</button>
        </nav>
        
        <div class="content">
            <!-- Home Section -->
            <div id="home" class="section active">
                <div class="card">
                    <h3>Welcome to AI-Powered Building Materials Leasing</h3>
                    <p>Our platform revolutionizes the way you lease building materials and equipment. Using advanced AI algorithms, we provide:</p>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li>Intelligent material recommendations based on your project needs</li>
                        <li>Optimized pricing with automatic discounts</li>
                        <li>Comprehensive inventory of construction materials</li>
                        <li>Easy lease management and tracking</li>
                    </ul>
                </div>
                
                <div class="info-box">
                    <h4>ü§ñ AI Features</h4>
                    <p><strong>Smart Recommendations:</strong> Describe your project and get AI-powered material suggestions tailored to your needs.</p>
                    <p><strong>Dynamic Pricing:</strong> Automatic discounts based on lease duration and quantity - save up to 30%!</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div class="card">
                        <h4>üì¶ 15+ Categories</h4>
                        <p>Extensive catalog of construction materials and equipment</p>
                    </div>
                    <div class="card">
                        <h4>üí∞ Best Prices</h4>
                        <p>AI-optimized pricing with volume and duration discounts</p>
                    </div>
                    <div class="card">
                        <h4>‚ö° Quick Setup</h4>
                        <p>Easy-to-use API and web interface</p>
                    </div>
                </div>
            </div>
            
            <!-- Materials Section -->
            <div id="materials" class="section">
                <h2>Building Materials Catalog</h2>
                <div class="form-group" style="margin: 20px 0;">
                    <input type="text" id="searchInput" placeholder="Search materials..." 
                           onkeyup="searchMaterials()" style="max-width: 400px;">
                </div>
                <div id="materialsGrid" class="material-grid">
                    <div class="loading">Loading materials...</div>
                </div>
            </div>
            
            <!-- Recommendations Section -->
            <div id="recommendations" class="section">
                <h2>AI Material Recommendations</h2>
                <div class="card">
                    <h3>Get Intelligent Material Suggestions</h3>
                    <p>Describe your construction project and our AI will recommend the most suitable materials.</p>
                </div>
                
                <form onsubmit="getRecommendations(event)">
                    <div class="form-group">
                        <label for="projectType">Project Type (Optional)</label>
                        <select id="projectType">
                            <option value="">Select type...</option>
                            <option value="Residential Construction">Residential Construction</option>
                            <option value="Commercial Building">Commercial Building</option>
                            <option value="Infrastructure">Infrastructure</option>
                            <option value="Renovation">Renovation</option>
                            <option value="Industrial">Industrial</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="projectDescription">Project Description *</label>
                        <textarea id="projectDescription" required 
                                  placeholder="e.g., Building a 5-story residential apartment complex with underground parking..."></textarea>
                    </div>
                    
                    <button type="submit">Get AI Recommendations</button>
                </form>
                
                <div id="recommendationResults"></div>
            </div>
            
            <!-- Pricing Section -->
            <div id="pricing" class="section">
                <h2>AI Pricing Calculator</h2>
                <div class="card">
                    <h3>Optimize Your Leasing Costs</h3>
                    <p>Calculate optimized pricing with automatic discounts based on duration and quantity.</p>
                </div>
                
                <form onsubmit="calculatePricing(event)">
                    <div class="form-group">
                        <label for="pricingMaterial">Material</label>
                        <select id="pricingMaterial" required>
                            <option value="">Select material...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="quantity">Quantity</label>
                        <input type="number" id="quantity" required min="1" value="10">
                    </div>
                    
                    <div class="form-group">
                        <label for="duration">Lease Duration (Days)</label>
                        <input type="number" id="duration" required min="1" value="30">
                    </div>
                    
                    <button type="submit">Calculate Price</button>
                </form>
                
                <div id="pricingResults"></div>
            </div>
            
            <!-- About Section -->
            <div id="about" class="section">
                <h2>About the Platform</h2>
                <div class="card">
                    <h3>AI-Powered Leasing Solution</h3>
                    <p>This platform combines traditional building materials leasing with cutting-edge artificial intelligence to provide:</p>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li><strong>Intelligent Recommendations:</strong> Using TF-IDF vectorization and cosine similarity algorithms</li>
                        <li><strong>Dynamic Pricing:</strong> AI-optimized discounts based on lease duration and quantity</li>
                        <li><strong>Smart Search:</strong> Natural language processing for finding the right materials</li>
                        <li><strong>Complementary Suggestions:</strong> Discover related materials you might need</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>Technology Stack</h3>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li>Backend: Flask (Python)</li>
                        <li>AI/ML: scikit-learn</li>
                        <li>Database: SQLAlchemy + SQLite</li>
                        <li>API: RESTful architecture</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>API Endpoints</h3>
                    <p>Access the platform programmatically:</p>
                    <ul style="margin: 15px 0 15px 30px;">
                        <li>GET /api/materials - Browse materials</li>
                        <li>POST /api/recommendations/project - Get AI recommendations</li>
                        <li>POST /api/pricing/optimize - Calculate optimal pricing</li>
                        <li>POST /api/leases - Create new lease</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <footer>
            <p>&copy; 2024 AI Building Materials Leasing Platform | Powered by Artificial Intelligence</p>
        </footer>
    </div>
    
    <script>
        const API_BASE = '/api';
        let materials = [];
        
        // Show/hide sections
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('nav button').forEach(b => b.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');
            
            if (sectionId === 'materials') {
                loadMaterials();
            } else if (sectionId === 'pricing') {
                loadMaterialsForPricing();
            }
        }
        
        // Load materials
        async function loadMaterials() {
            try {
                const response = await fetch(`${API_BASE}/materials`);
                materials = await response.json();
                displayMaterials(materials);
            } catch (error) {
                document.getElementById('materialsGrid').innerHTML = 
                    '<div class="error">Error loading materials. Please try again.</div>';
            }
        }
        
        // Display materials
        function displayMaterials(materialsToShow) {
            const grid = document.getElementById('materialsGrid');
            
            if (materialsToShow.length === 0) {
                grid.innerHTML = '<div class="loading">No materials found.</div>';
                return;
            }
            
            grid.innerHTML = materialsToShow.map(mat => `
                <div class="material-card">
                    <span class="category">${mat.category}</span>
                    <h4>${mat.name}</h4>
                    <p>${mat.description}</p>
                    <div class="price">$${mat.price_per_day}/${mat.unit}/day</div>
                    <div class="available">Available: ${mat.quantity_available} ${mat.unit}</div>
                    <small>${mat.specifications || ''}</small>
                </div>
            `).join('');
        }
        
        // Search materials
        function searchMaterials() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = materials.filter(mat => 
                mat.name.toLowerCase().includes(searchTerm) ||
                mat.description.toLowerCase().includes(searchTerm) ||
                mat.category.toLowerCase().includes(searchTerm)
            );
            displayMaterials(filtered);
        }
        
        // Get recommendations
        async function getRecommendations(event) {
            event.preventDefault();
            
            const resultsDiv = document.getElementById('recommendationResults');
            resultsDiv.innerHTML = '<div class="loading">AI is analyzing your project...</div>';
            
            const projectDescription = document.getElementById('projectDescription').value;
            const projectType = document.getElementById('projectType').value;
            
            try {
                const response = await fetch(`${API_BASE}/recommendations/project`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        project_description: projectDescription,
                        project_type: projectType,
                        top_n: 8
                    })
                });
                
                const recommendations = await response.json();
                
                if (recommendations.length === 0) {
                    resultsDiv.innerHTML = '<div class="info-box">No recommendations found. Try a different description.</div>';
                    return;
                }
                
                resultsDiv.innerHTML = '<h3 style="margin: 20px 0;">AI Recommendations</h3>' +
                    recommendations.map(rec => `
                        <div class="recommendation">
                            <span class="score">Match: ${(rec.relevance_score * 100).toFixed(0)}%</span>
                            <h4>${rec.material.name}</h4>
                            <span class="category">${rec.material.category}</span>
                            <p>${rec.material.description}</p>
                            <div style="margin-top: 10px;">
                                <strong>Price:</strong> $${rec.material.price_per_day}/${rec.material.unit}/day<br>
                                <strong>Available:</strong> ${rec.material.quantity_available} ${rec.material.unit}<br>
                                <strong>Why recommended:</strong> ${rec.recommendation_reason}
                            </div>
                        </div>
                    `).join('');
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">Error getting recommendations. Please try again.</div>';
            }
        }
        
        // Load materials for pricing
        async function loadMaterialsForPricing() {
            try {
                const response = await fetch(`${API_BASE}/materials`);
                const materials = await response.json();
                
                const select = document.getElementById('pricingMaterial');
                select.innerHTML = '<option value="">Select material...</option>' +
                    materials.map(mat => `
                        <option value="${mat.id}">${mat.name} - $${mat.price_per_day}/${mat.unit}/day</option>
                    `).join('');
            } catch (error) {
                console.error('Error loading materials:', error);
            }
        }
        
        // Calculate pricing
        async function calculatePricing(event) {
            event.preventDefault();
            
            const resultsDiv = document.getElementById('pricingResults');
            resultsDiv.innerHTML = '<div class="loading">Calculating optimal pricing...</div>';
            
            const materialId = parseInt(document.getElementById('pricingMaterial').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const duration = parseInt(document.getElementById('duration').value);
            
            try {
                const response = await fetch(`${API_BASE}/pricing/optimize`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        material_id: materialId,
                        lease_duration_days: duration,
                        quantity: quantity
                    })
                });
                
                const pricing = await response.json();
                
                resultsDiv.innerHTML = `
                    <div class="pricing-result">
                        <h3>üí∞ Optimized Pricing for ${pricing.material_name}</h3>
                        <div class="pricing-detail">
                            <span>Base Price:</span>
                            <span>$${pricing.base_price_per_day}/${pricing.quantity > 1 ? 'unit' : 'day'}</span>
                        </div>
                        <div class="pricing-detail">
                            <span>Duration Discount:</span>
                            <span>${pricing.duration_discount_percent}%</span>
                        </div>
                        <div class="pricing-detail">
                            <span>Quantity Discount:</span>
                            <span>${pricing.quantity_discount_percent}%</span>
                        </div>
                        <div class="pricing-detail">
                            <span>Total Discount:</span>
                            <span>${pricing.total_discount_percent}%</span>
                        </div>
                        <div class="pricing-detail">
                            <span>Discounted Price:</span>
                            <span>$${pricing.discounted_price_per_day}/day</span>
                        </div>
                        <div class="pricing-detail">
                            <span>Total Cost:</span>
                            <span>$${pricing.total_cost}</span>
                        </div>
                        ${pricing.savings > 0 ? `
                        <div class="pricing-detail">
                            <span>You Save:</span>
                            <span>$${pricing.savings}</span>
                        </div>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = '<div class="error">Error calculating pricing. Please try again.</div>';
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('AI Building Materials Leasing Platform initialized');
            
            // Register Service Worker for PWA
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/static/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            }
            
            // Handle PWA install prompt
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                // Prevent the mini-infobar from appearing on mobile
                e.preventDefault();
                // Stash the event so it can be triggered later
                deferredPrompt = e;
                // Show install button or notification
                console.log('PWA install prompt available');
            });
            
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed');
                deferredPrompt = null;
            });
        });
    </script>
</body>
</html>
